| m_aInputParams:P1, m_aResult, m_cModus |

//#p .migration-be7\migbe7-assistent\utils-cleaning

//******************************************************************************
function GetSqlWHERE()
   Result :=
     '   LEFT JOIN "DAB420.ADT" DAB420 ON (DAB420.LFD_NR = CAST(SubString(RTrim(REPORT_ID), 5, 4) AS SQL_INTEGER)) ' + crlf +
     '   WHERE ' + crlf +
     "          Left(REPORT_ID, 4) = 'STAT' " + crlf +
     '      AND DAB420.LFD_NR IS NULL // Report existiert nicht',
end,

//******************************************************************************
function Check()
   CheckUtils_Cleaning_Standard_Check(waDabR10, GetSqlWHERE(), 'DISTINCT REPORT_ID, REPORT_NR, BEZ, AEND_DAT', {12, 10, 40, 10}, '', 'REPORT_ID, REPORT_NR, BEZ, AEND_DAT', m_aResult),
end,

//******************************************************************************
function Execute()
   if BeMessageDlgEx('Daten-Aktion durchführen?' + crlf + crlf + 'Durch diese Aktion werden Daten im System geändert!', mtWarning, {'Aktion durchführen', 'Abbrechen'}, {10, 20}, 20, 20) = 10 then
      CheckUtils_Cleaning_Via_Archive_And_Delete_By_SQL(GetSqlWHERE(), waDabR10, 'report-gen-stat-does-not-exist', m_aResult, '[ROWID]'),
   else
      KVU_Set(m_aResult, 'RESULT', 'DID_NOT_EXECUTE'),
   endif,  
end,

//##############################################################################
//##############################################################################

m_aResult := {},
m_cModus  := KVU_Get(m_aInputParams, 'MODUS', 'INFO'),
case true
  of m_cModus == 'CHECK' or EditorMode() :: Check(),
  of m_cModus == 'EXECUTE'               :: Execute(),
endcase,

KVU_Set(m_aResult, 'BEZ',         'Daten-Bereinigung: Layouts von gelöschten Reports'),
KVU_Set(m_aResult, 'KOMMENTAR',   'Layouts für Report-Generator-Statistiken, die nicht (mehr) existieren, sollten bereinigt werden.'),

KVU_Set(m_aResult, 'EXECUTABLE',            true),
KVU_Set(m_aResult, 'EXECUTABLE_CAPTION',    'Datenbereinigung durchführen...'),
KVU_Set(m_aResult, 'EXECUTABLE_IMG_INDEX',  195),

m_aResult
